basePath: /
definitions:
  github_com_rogerwesterbo_godns_internal_models.DNSRecord:
    properties:
      name:
        description: Fully qualified domain name
        example: www.example.lan.
        type: string
      ttl:
        description: Time to live in seconds
        example: 300
        type: integer
      type:
        description: A, AAAA, MX, NS, TXT, etc.
        example: A
        type: string
      value:
        description: The record value (IP, hostname, etc.)
        example: 192.168.1.100
        type: string
    type: object
  github_com_rogerwesterbo_godns_internal_models.DNSZone:
    properties:
      domain:
        description: e.g., "example.lan."
        example: example.lan.
        type: string
      records:
        description: DNS records in this zone
        items:
          $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSRecord'
        type: array
    type: object
  github_com_rogerwesterbo_godns_internal_services_v1searchservice.SearchResponse:
    properties:
      count:
        description: Number of results found
        example: 5
        type: integer
      query:
        description: The search query
        example: example
        type: string
      results:
        description: List of search results
        items:
          $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_services_v1searchservice.SearchResult'
        type: array
    type: object
  github_com_rogerwesterbo_godns_internal_services_v1searchservice.SearchResult:
    properties:
      record:
        allOf:
        - $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSRecord'
        description: Record details (if type is record)
      type:
        allOf:
        - $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_services_v1searchservice.SearchResultType'
        description: Type of result (zone, record)
        example: zone
      zone:
        description: Zone name
        example: example.lan
        type: string
    type: object
  github_com_rogerwesterbo_godns_internal_services_v1searchservice.SearchResultType:
    enum:
    - zone
    - record
    type: string
    x-enum-varnames:
    - SearchResultTypeZone
    - SearchResultTypeRecord
  internal_httpserver_handlers_v1adminhandler.CacheStats:
    properties:
      current_size:
        type: integer
      enabled:
        type: boolean
      hit_rate:
        type: string
      max_size:
        type: integer
      ttl_minutes:
        type: integer
    type: object
  internal_httpserver_handlers_v1adminhandler.HealthCheckResultInfo:
    properties:
      error_message:
        type: string
      healthy:
        type: boolean
      last_check:
        type: string
      last_failure:
        type: string
      last_success:
        type: string
      target:
        type: string
    type: object
  internal_httpserver_handlers_v1adminhandler.HealthCheckStats:
    properties:
      enabled:
        type: boolean
      interval_seconds:
        type: integer
      results:
        items:
          $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.HealthCheckResultInfo'
        type: array
      timeout_seconds:
        type: integer
      total_targets:
        type: integer
    type: object
  internal_httpserver_handlers_v1adminhandler.LoadBalancerBackendInfo:
    properties:
      enabled:
        type: boolean
      healthy:
        type: boolean
      name:
        type: string
      type:
        type: string
      value:
        type: string
      weight:
        type: integer
    type: object
  internal_httpserver_handlers_v1adminhandler.LoadBalancerStats:
    properties:
      backend_groups:
        type: integer
      backends:
        items:
          $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.LoadBalancerBackendInfo'
        type: array
      enabled:
        type: boolean
      healthy_backends:
        type: integer
      strategy:
        type: string
      total_backends:
        type: integer
    type: object
  internal_httpserver_handlers_v1adminhandler.QueryLogStats:
    properties:
      blocked_queries:
        type: integer
      blocked_rate:
        type: number
      cache_hit_rate:
        type: number
      cached_queries:
        type: integer
      enabled:
        type: boolean
      total_queries:
        type: integer
    type: object
  internal_httpserver_handlers_v1adminhandler.RateLimiterStats:
    properties:
      active_limiters:
        type: integer
      burst:
        type: integer
      enabled:
        type: boolean
      qps:
        type: integer
    type: object
  internal_httpserver_handlers_v1adminhandler.SystemStats:
    properties:
      cache:
        $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.CacheStats'
      health_check:
        $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.HealthCheckStats'
      load_balancer:
        $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.LoadBalancerStats'
      query_log:
        $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.QueryLogStats'
      rate_limiter:
        $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.RateLimiterStats'
    type: object
host: localhost:14000
info:
  contact:
    email: support@example.com
    name: GoDNS Support
    url: https://github.com/rogerwesterbo/godns
  description: |-
    RESTful API for managing DNS zones and records in GoDNS

    This API provides CRUD operations for DNS zones and records, storing data in Valkey (Redis-compatible).

    ## Features
    - Create, read, update, and delete DNS zones
    - Manage individual DNS records within zones
    - Support for various record types (A, AAAA, CNAME, MX, NS, TXT, PTR, SRV, SOA, CAA)
    - Health and readiness endpoints for Kubernetes deployments

    ## Authentication
    This API uses OAuth2/JWT authentication via Keycloak.

    To authenticate:
    1. Click "Authorize" button
    2. For BearerAuth: Enter "Bearer YOUR_JWT_TOKEN"
    3. For OAuth2: Enter credentials (testuser/password for development)

    To get a token manually:
    ```
    curl -X POST "http://localhost:14101/realms/godns/protocol/openid-connect/token" -H "Content-Type: application/x-www-form-urlencoded" -d "client_id=godns-cli" -d "username=testuser" -d "password=password" -d "grant_type=password"
    ```

    Extract and use the access_token:
    ```
    TOKEN=$(curl -s -X POST "http://localhost:14101/realms/godns/protocol/openid-connect/token" -H "Content-Type: application/x-www-form-urlencoded" -d "client_id=godns-cli" -d "username=testuser" -d "password=password" -d "grant_type=password" | jq -r '.access_token')

    curl -H "Authorization: Bearer $TOKEN" http://localhost:14000/api/v1/zones
    ```

    Use HTTPS (port 14102) for production.
  license:
    name: MIT
    url: https://github.com/rogerwesterbo/godns/blob/main/LICENSE
  title: GoDNS API
  version: "1.0"
paths:
  /api/v1/admin/cache/clear:
    post:
      description: Clear all entries from the DNS response cache
      responses:
        "204":
          description: Cache cleared successfully
        "503":
          description: Cache service not available
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Clear DNS cache
      tags:
      - Admin
  /api/v1/admin/cache/stats:
    get:
      description: Get detailed statistics about DNS response caching
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.CacheStats'
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Get cache statistics
      tags:
      - Admin
  /api/v1/admin/healthcheck/stats:
    get:
      description: Get detailed health check results for all monitored backends
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.HealthCheckStats'
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Get health check statistics
      tags:
      - Admin
  /api/v1/admin/loadbalancer/stats:
    get:
      description: Get detailed statistics about load balancing including backend
        health status
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.LoadBalancerStats'
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Get load balancer statistics
      tags:
      - Admin
  /api/v1/admin/querylog/stats:
    get:
      description: Get statistics about DNS queries including cache hit rate and blocked
        queries
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.QueryLogStats'
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Get query log statistics
      tags:
      - Admin
  /api/v1/admin/ratelimiter/stats:
    get:
      description: Get statistics about rate limiting including active limiters
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.RateLimiterStats'
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Get rate limiter statistics
      tags:
      - Admin
  /api/v1/admin/stats:
    get:
      description: Get comprehensive statistics about DNS caching, rate limiting,
        load balancing, health checks, and query logging
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/internal_httpserver_handlers_v1adminhandler.SystemStats'
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Get system statistics
      tags:
      - Admin
  /api/v1/export:
    get:
      description: Export all DNS zones in a specified format (coredns, powerdns,
        bind, zonefile)
      parameters:
      - default: bind
        description: 'Export format: coredns, powerdns, bind, or zonefile'
        in: query
        name: format
        type: string
      produces:
      - text/plain
      responses:
        "200":
          description: Exported zone configuration
          schema:
            type: string
        "400":
          description: Invalid format
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Export all zones
      tags:
      - Export
  /api/v1/export/{zone}:
    get:
      description: Export a specific DNS zone in a specified format
      parameters:
      - description: Zone name (e.g., example.lan)
        in: path
        name: zone
        required: true
        type: string
      - default: bind
        description: 'Export format: coredns, powerdns, bind, or zonefile'
        in: query
        name: format
        type: string
      produces:
      - text/plain
      responses:
        "200":
          description: Exported zone configuration
          schema:
            type: string
        "400":
          description: Invalid format
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Zone not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Export a specific zone
      tags:
      - Export
  /api/v1/search:
    get:
      description: Search across DNS zones and records with optional type filtering
      parameters:
      - description: Search query (case-insensitive)
        in: query
        name: q
        required: true
        type: string
      - collectionFormat: csv
        description: Filter by result type (zone, record). Can specify multiple types.
        in: query
        items:
          enum:
          - zone
          - record
          type: string
        name: type
        type: array
      produces:
      - application/json
      responses:
        "200":
          description: Search results
          schema:
            $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_services_v1searchservice.SearchResponse'
        "400":
          description: Invalid request parameters
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Search DNS zones and records
      tags:
      - Search
  /api/v1/zones:
    get:
      description: Get a list of all DNS zones
      produces:
      - application/json
      responses:
        "200":
          description: List of zones
          schema:
            items:
              $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSZone'
            type: array
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: List all DNS zones
      tags:
      - Zones
    post:
      consumes:
      - application/json
      description: Create a new DNS zone with optional records
      parameters:
      - description: Zone to create
        in: body
        name: zone
        required: true
        schema:
          $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSZone'
      produces:
      - application/json
      responses:
        "201":
          description: Zone created
          schema:
            $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSZone'
        "400":
          description: Invalid request body
          schema:
            additionalProperties:
              type: string
            type: object
        "409":
          description: Zone already exists
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Create a new DNS zone
      tags:
      - Zones
  /api/v1/zones/{zone}:
    delete:
      description: Delete a DNS zone and all its records
      parameters:
      - description: Zone name (e.g., example.lan)
        in: path
        name: zone
        required: true
        type: string
      responses:
        "204":
          description: Zone deleted
        "404":
          description: Zone not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Delete a DNS zone
      tags:
      - Zones
    get:
      description: Get a specific DNS zone by name
      parameters:
      - description: Zone name (e.g., example.lan)
        in: path
        name: zone
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Zone details
          schema:
            $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSZone'
        "404":
          description: Zone not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Get a DNS zone
      tags:
      - Zones
    put:
      consumes:
      - application/json
      description: Update an existing DNS zone (replaces all records)
      parameters:
      - description: Zone name (e.g., example.lan)
        in: path
        name: zone
        required: true
        type: string
      - description: Updated zone data
        in: body
        name: zone
        required: true
        schema:
          $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSZone'
      produces:
      - application/json
      responses:
        "200":
          description: Zone updated
          schema:
            $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSZone'
        "400":
          description: Invalid request body
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Zone not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Update a DNS zone
      tags:
      - Zones
  /api/v1/zones/{zone}/records:
    post:
      consumes:
      - application/json
      description: Add a new DNS record to an existing zone
      parameters:
      - description: Zone name (e.g., example.lan)
        in: path
        name: zone
        required: true
        type: string
      - description: Record to create
        in: body
        name: record
        required: true
        schema:
          $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSRecord'
      produces:
      - application/json
      responses:
        "201":
          description: Record created
          schema:
            $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSRecord'
        "400":
          description: Invalid request body
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Zone not found
          schema:
            additionalProperties:
              type: string
            type: object
        "409":
          description: Record already exists
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Create a DNS record
      tags:
      - Records
  /api/v1/zones/{zone}/records/{name}/{type}:
    delete:
      description: Delete a specific DNS record from a zone
      parameters:
      - description: Zone name (e.g., example.lan)
        in: path
        name: zone
        required: true
        type: string
      - description: Record name (e.g., www.example.lan.)
        in: path
        name: name
        required: true
        type: string
      - description: Record type (e.g., A, AAAA, CNAME)
        in: path
        name: type
        required: true
        type: string
      responses:
        "204":
          description: Record deleted
        "404":
          description: Zone or record not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Delete a DNS record
      tags:
      - Records
    get:
      description: Get a specific DNS record by name and type
      parameters:
      - description: Zone name (e.g., example.lan)
        in: path
        name: zone
        required: true
        type: string
      - description: Record name (e.g., www.example.lan.)
        in: path
        name: name
        required: true
        type: string
      - description: Record type (e.g., A, AAAA, CNAME)
        in: path
        name: type
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Record details
          schema:
            $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSRecord'
        "404":
          description: Zone or record not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Get a DNS record
      tags:
      - Records
    put:
      consumes:
      - application/json
      description: Update an existing DNS record
      parameters:
      - description: Zone name (e.g., example.lan)
        in: path
        name: zone
        required: true
        type: string
      - description: Record name (e.g., www.example.lan.)
        in: path
        name: name
        required: true
        type: string
      - description: Record type (e.g., A, AAAA, CNAME)
        in: path
        name: type
        required: true
        type: string
      - description: Updated record data
        in: body
        name: record
        required: true
        schema:
          $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSRecord'
      produces:
      - application/json
      responses:
        "200":
          description: Record updated
          schema:
            $ref: '#/definitions/github_com_rogerwesterbo_godns_internal_models.DNSRecord'
        "400":
          description: Invalid request body
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Zone or record not found
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal server error
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      - OAuth2Password: []
      summary: Update a DNS record
      tags:
      - Records
produces:
- application/json
schemes:
- http
- https
securityDefinitions:
  BearerAuth:
    description: Type "Bearer" followed by a space and JWT token.
    in: header
    name: Authorization
    type: apiKey
  OAuth2Password:
    flow: password
    tokenUrl: http://localhost:14101/realms/godns/protocol/openid-connect/token
    type: oauth2
swagger: "2.0"
tags:
- description: Health check and readiness endpoints
  name: Health
- description: DNS zone management operations
  name: Zones
- description: DNS record management operations
  name: Records
